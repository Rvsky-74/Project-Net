import{initializeApp as oe}from"https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";import{getAuth as se,onAuthStateChanged as ae}from"https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";import{getFirestore as ie,doc as I,setDoc as U,collection as re,getDocs as le,getDoc as M,deleteDoc as O,updateDoc as ce}from"https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}})();const i={nodes:[],link_mode_on:!1,simulating:!1,isMouseDown:!1,dragged:!1,start_coords:[0,0],end_coords:[0,0],box_opened:!1,current_save_file:""},de={apiKey:"AIzaSyC_QBQdq1WeLVaIQH_084N__VQISVz5rbk",authDomain:"task-manager-82b19.firebaseapp.com",projectId:"task-manager-82b19",storageBucket:"task-manager-82b19.firebasestorage.app",messagingSenderId:"114619358141",appId:"1:114619358141:web:d24dfd48a7be49018010d4"},Q=oe(de),T=se(Q),k=ie(Q);async function H(e,o){const n=T.currentUser,s=document.getElementById("Canvas_Text"),t=[];document.querySelectorAll(".node").forEach(r=>{const l=(r.connections||[]).map(y=>y.name);t.push({name:r.name,x:r.getBoundingClientRect().left,y:r.getBoundingClientRect().top,state:r.state,connections:l})});const u=I(k,"users",n.uid,"saves",String(e));await U(u,{name:o,node_info:t},{merge:!0}),s.innerText="Data Saved"}async function ue(){const e=T.currentUser;if(!e){print("saveUserData was called incorrectly");return}const o=I(k,"users",e.uid),n={firstName:e.displayName||"Unknown",email:e.email,lastLogin:new Date().toISOString()};await U(o,n,{merge:!0})}ae(T,e=>{const o=document.getElementById("log");if(e){console.log("User is logged in:",e),o.innerText="Logout";const n=e.photoURL,s=document.getElementById("profile-pic");s.src=n,s.onerror=function(){s.src="no-user.png"},ue()}else{console.log("No user is logged in"),o.innerText="Login";const n=document.getElementById("profile-pic");n.src="no-user.png",j()}});async function me(e){const o=T.currentUser,n=document.getElementById("Canvas_Text");try{const s=I(k,"users",o.uid,"saves",String(e)),t=await M(s);if(t.exists()){const u=t.data().node_info||[];j(),u.forEach(c=>{Z(c.x,c.y,c.name,c.state)}),u.forEach(c=>{const r=i.nodes.find(d=>d.name===c.name);c.connections.forEach(d=>{const l=i.nodes.find(y=>y.name===d);create_arrow(r,l),r.connections.push(l)})}),i.nodes.forEach(c=>D(c,c.state,c.state)),n.innerText=i.current_save_file}else n.innerText="No saved data found"}catch(s){console.error("Error loading user data:",s),n.innerText="Error loading data"}}async function fe(){const e=T.currentUser;if(!e){print("Please login before saving/loading data");return}const o=re(k,"users",e.uid,"saves");return(await le(o)).docs.map(t=>[t.id,t.data().name])}async function W(e,o){const n=T.currentUser,s=I(k,"users",n.uid,"saves",String(e));if(!(await M(s)).exists()){print("Something went wrong, this file number doesnt exist");return}if(o.length==0){await O(s);let a=parseInt(e,10)+1;for(;;){const u=I(k,"users",n.uid,"saves",String(a)),c=await M(u);if(c.exists()){const r=I(k,"users",n.uid,"saves",String(a-1));await U(r,c.data()),await O(u)}else return;a+=1}}else await ce(s,{name:o})}const b=document.getElementById("circleCanvas"),w=document.getElementById("canvas-container");let x,q=[b.width/2,b.height/2];function pe(e){const o=parseInt(window.getComputedStyle(e).getPropertyValue("width").slice(0,2));e.addEventListener("mouseenter",function(n){document.querySelectorAll(".node").forEach(t=>{t.style.setProperty("--alpha",.3)}),e.style.setProperty("--alpha",1),e.style.setProperty("--diameter",1.2*o+"px"),document.querySelectorAll(".arrow").forEach(t=>{t.parent!==e&&t.style.setProperty("--alpha",.3)})}),e.addEventListener("mouseleave",function(n){document.querySelectorAll(".node").forEach(t=>{t.style.setProperty("--alpha",1),t.style.setProperty("--diameter",o+"px")}),document.querySelectorAll(".arrow").forEach(t=>{t.style.setProperty("--alpha",1)})})}function ve(e){e.addEventListener("click",function(o){if(o.stopPropagation(),i.link_mode_on){if(x!=e&&!x.connections.includes(e)&&!e.connections.includes(x)){if(X(x,e)){S("That would make a loop impossible to complete");return}x.connections.push(e),he(x,e),D(e,e.state,e.state);return}if(x.connections.includes(e)){document.querySelectorAll(".arrow").forEach(t=>{t.parent==x&&t.child==e&&t.remove()});let s=x.connections.indexOf(e);s!==-1&&x.connections.splice(s,1),D(e,e.state,e.state),D(x,x.state,x.state);return}}!i.box_opened&&!i.link_mode_on&&ge(e)})}function he(e,o){const n=document.createElement("div");n.classList.add("arrow",o.state),w.appendChild(n);const s=document.createElement("div");s.className="tip",n.appendChild(s);const t=document.createElement("div");t.className="line",n.appendChild(t),n.parent=e,n.child=o,Y(n)}function z(e=0,o=0){document.querySelectorAll(".arrow").forEach(n=>{Y(n,e,o)})}function Y(e,o=0,n=0){const s=e.querySelector(".tip"),t=e.querySelector(".line"),a={x:e.child.x,y:e.child.y},u={x:e.parent.x,y:e.parent.y},c=a.x-u.x,r=a.y-u.y;let d=Math.atan2(r,c),l=Math.sqrt(c*c+r*r);d<Math.PI/2&&(d-=.01),d<-Math.PI/2&&(d+=.01);const y=getComputedStyle(e.parent),v=parseInt(y.getPropertyValue("--diameter").slice(0,2))/2,p=Math.sqrt(50)/2,h=3,g=a.x-(v+p+2*h)*c/l,m=a.y-(v+p+2*h)*r/l;s.style.transform=`translate(-50%, -50%) translate(${g+o}px,${m+n}px) rotate(${d+Math.PI/4}rad)`,t.style.width=l-2*v-3*h-p+"px";const E=u.x+(v+2*h)*Math.cos(d),_=u.y+(v+2*h)*Math.sin(d);t.style.transform=`translate(${E+o}px,${_+n}px) rotate(${d}rad)`}function D(e,o,n){e.state=n,e.connections.length==0&&n!="Completed"&&e.classList.replace("undoable","doable"),document.querySelectorAll(".arrow").forEach(s=>{s.child===e&&(s.classList.replace(o,n),s.parent.connections.filter(t=>t.state==="Uncompleted"||t.state==="Default").length==0?s.parent.state!="Completed"&&s.parent.classList.replace("undoable","doable"):s.parent.classList.replace("doable","undoable"))}),e.state=="Completed"&&e.classList.replace("doable","undoable"),K(e)}function F(e){const o=[];return document.querySelectorAll(".arrow").forEach(n=>{n.child===e&&o.push(n.parent)}),o}function K(e,o=new Set){o.add(e);const n=F(e).filter(s=>s.state==="Completed").length!=0;n?e.classList.add("complete-mask"):e.classList.remove("complete-mask"),document.querySelectorAll(".arrow").forEach(s=>{if(s.child==e){let t=s.querySelector(".line"),a=s.querySelector(".tip");n?(t.classList.add("line-mask"),a.classList.add("tip-mask")):(t.classList.remove("line-mask"),a.classList.remove("tip-mask"))}}),e.connections.forEach(s=>{o.has(s)||K(s,o)})}let P="";function ye(e,o,n,s,t){let a;const u=document.createElement("div");u.className="bar",e.appendChild(u);const c=document.createElement("div");c.className="bar",c.style.transform="rotate(90deg)",e.appendChild(c),[e,o,n,s,t].forEach(d=>{d.addEventListener("mouseenter",()=>{a=setTimeout(()=>{const l=document.createElement("div");l.className="tooltip";const y={addbutton:"New Task",savebutton:"Save Current Project",loadbutton:"Load Saved Project",deletebutton:"Clear Canvas",infobutton:"Instructions / Help"};l.textContent=y[d.id],l.style.position="absolute",l.style.right="110%",l.style.top="50%",l.style.transform="translateY(-50%)",l.style.padding="5px 10px",l.style.background="black",l.style.color="white",l.style.borderRadius="5px",l.style.fontSize="12px",l.style.whiteSpace="nowrap",d.appendChild(l)},500)}),d.addEventListener("mouseleave",()=>{clearTimeout(a);const l=d.querySelector(".tooltip");l&&l.remove()})}),e.addEventListener("click",()=>{if(document.querySelector(".input-box")!=null)return;let l=document.createElement("input");l.className="input-box",l.type="text",l.placeholder="Enter task name...",w.appendChild(l),l.focus(),l.addEventListener("keydown",y=>{if(y.key==="Enter"&&l.value.trim()!=""){if(P=l.value.trim(),l.remove(),!ne(P)){let m=function(E){v.style.setProperty("--diameter",g+"px"),v.removeEventListener("transitionend",m)};S("Task already in the project");const v=i.nodes.find(E=>E.name===P),p=b.width/2-v.x,h=b.height/2-v.y;xe(p,h);const g=parseInt(window.getComputedStyle(v).getPropertyValue("--diameter").slice(0,-2),10);v.style.setProperty("--diameter",g*1.3+"px"),v.addEventListener("transitionend",m);return}Z(null,null,P)}y.key=="Escape"&&l.remove()})}),o.addEventListener("click",()=>{j()}),n.addEventListener("click",()=>{B("save")}),s.addEventListener("click",()=>{B("load")}),t.addEventListener("click",()=>{document.querySelector(".help").style.display="block"})}async function B(e){const o=await fe();if(!o||(e=="save"?S("Choose where to save the current project"):S("Choose a file to load from"),document.querySelector(".save-files-menu")))return;const s=f("div",w,null,["save-files-menu"]);if(o.forEach(t=>{const a=t[0],u=t[1],c=f("button",s,null,["save-file"]),r=f("div",c,null,["save-number"]),d=f("div",c,null,["file-name"]);r.textContent=a,d.textContent=u;const l=f("button",c,null,["edit-save-file"]);l.style.maskImage="url(pencil.svg)";let y=!1;l.addEventListener("click",async v=>{if(v.stopPropagation(),y)await W(a,""),s.remove(),B(e);else{y=!0,l.style.maskImage="url(trash.svg)";const p=document.createElement("input");p.type="text",p.value=d.textContent,p.className="file-name",c.replaceChild(p,d),p.focus(),p.addEventListener("keydown",h=>{h.key==="Enter"&&p.value.trim()!==""&&(d.textContent=p.value.trim(),y=!1,l.style.maskImage="url(pencil.svg)",W(a,p.value.trim()),c.replaceChild(d,p)),h.key==="Escape"&&(y=!1,l.style.maskImage="url(pencil.svg)",p.remove())})}}),c.addEventListener("click",function(v){e==="save"?H(a,u):(i.current_save_file=u,me(a)),s.remove()})}),e=="save"){const t=f("button",s,null,["save-file"]),a=f("div",t,null,["save-number"]),u=f("div",t,null,["file-name"]);a.textContent=o.length+1,u.textContent="New Save File",t.addEventListener("click",()=>{s.remove(),f("input",w,null,["input-box"]);const c=f("input",w,null,["input-box"]);c.type="text",c.placeholder="Enter task name...",c.focus(),c.addEventListener("keydown",r=>{r.key==="Enter"&&c.value.trim()!=""&&(H(o.length+1,c.value.trim()),c.remove()),r.key=="Escape"&&c.remove()})})}if(e=="load"&&o.length==0){const t=f("button",s,null,["save-file"]),a=f("div",t,null,["file-name"]);a.textContent="No save files yet"}}function ge(e){i.simulating&&A(),i.box_opened=!0;const[o,n]=[e.x,e.y],s=f("div",w,"box",["box",e.state]);s.style.left=`${o}px`,s.style.top=`${n}px`;const t=f("div",w,"sub-box",["sub-box",e.state]);t.style.left=`${o}px`,t.style.top=`${n}px`,new MutationObserver(g=>{for(const m of g)for(const E of m.removedNodes)E===s&&t.remove()}).observe(w,{childList:!0});const u=f("button",t,null,["button"]),c=f("div",u,null,["icon"]);c.style.maskImage="url(cross.svg)",u.addEventListener("click",g=>{document.querySelectorAll(".arrow").forEach(m=>{(m.child===e||m.parent===e)&&m.remove()}),parents=F(e),parents.forEach(m=>{idx=m.connections.indexOf(e),m.connections.splice(idx,1),m.connections.filter(E=>E.state==="Uncompleted"||E.state==="Default").length==0&&arrow.parent.state!="Completed"&&arrow.parent.classList.replace("undoable","doable")}),e.remove()});const r=f("button",t,null,["button"]),d=f("div",r,null,["icon"]);d.style.maskImage="url(pencil.svg)",r.addEventListener("click",g=>{const m=e.querySelector(".text"),E=m.textContent,_=document.createElement("input");_.type="text",_.value=m.textContent,m.textContent="",_.className="text",m.appendChild(_),_.focus(),_.addEventListener("keydown",function(R){R.key==="Enter"&&(_.value!=""?(m.textContent=_.value,e.name=_.value,_.remove()):S("Please enter a name for the node")),R.key==="Escape"&&(m.textContent=E,_.remove())}),_.addEventListener("blur",function(){_.value!=""&&(m.textContent=_.value,e.name=_.value,_.remove())})});const l=f("div",s,null,["button-text-wrapper"]),y=f("div",l,null,["state-text"]);y.textContent=e.state==="Default"?"Undefined":e.state;const v=f("button",l,null,["rounded-square-btn",e.state]);f("div",v,null,["small-circle"]),v.addEventListener("click",g=>{v.classList.toggle("active");const m=e.state==="Default"||e.state==="Uncompleted"?"Completed":"Uncompleted";s.classList.replace(e.state,m),t.classList.replace(e.state,m),v.classList.replace(e.state,m),e.classList.replace(e.state,m),y.textContent=m,D(e,e.state,m)});const p=f("div",s),h=f("button",p,"b1",["link-button"]);h.textContent="Make Connections",h.addEventListener("click",g=>{i.link_mode_on=!0,x=e,C(),s.remove(),i.box_opened=!1,b.classList.replace("canvas-default","canvas-alt"),S("Select pre-requisites for this task")})}function _e(){b.classList.replace("canvas-alt","canvas-default"),document.getElementById("Canvas_Text").innerText="",i.link_mode_on=!1,C(),i.simulating&&A()}function xe(e,o){document.querySelectorAll(".node").forEach(n=>{n.x+=e,n.y+=o,n.style.left=n.x+"px",n.style.top=n.y+"px",n.style.transform="translate(-50%, -50%)"}),q[0]+=e,q[1]+=o,z()}function X(e,o,n=new Set){if(e===o)return!0;n.add(o);for(let s of o.connections)if(!n.has(s)&&X(e,s,n))return!0;return!1}function G(e){e.forEach(o=>{let s=o.clientHeight;for(o.style.fontSize=s+"px";(o.scrollHeight>o.clientHeight||o.scrollWidth>o.clientWidth)&&(s--,o.style.fontSize=s+"px",!(s<5)););})}const J=document.querySelectorAll(".file-name");G(J);window.addEventListener("resize",()=>G(J));function Z(e=null,o=null,n=null,s="Default"){for(;!ne(n);)n+="+";const t=document.createElement("div");t.classList.add("node","Default","doable"),t.style.left=e!=null?e+"px":Math.random()*b.width+"px",t.style.top=o!=null?o+"px":Math.random()*b.height+"px",t.connections=[],t.name=n,t.movimento=[0,0],t.state=s,t.x=parseInt(t.style.left,10),t.y=parseInt(t.style.top,10),w.appendChild(t),i.nodes.push(t),pe(t),ve(t);const a=document.createElement("div");return a.className="text",a.textContent=n,t.appendChild(a),i.simulating||A(),t}let V;function A(){i.simulating?(i.simulating=!1,clearInterval(V)):(i.simulating=!0,V=setInterval(()=>{e()},10));function e(){for(let r=0;r<i.nodes.length;r++)i.nodes[r].movimento=[0,0];for(let r=0;r<i.nodes.length;r++){const d=i.nodes[r];for(let l=0;l<i.nodes.length;l++){if(l!=r){const p=i.nodes[l];let h=Math.sqrt((d.x-p.x)**2+(d.y-p.y)**2);h<20&&(h=20);let g=[(p.x-d.x)/h,(p.y-d.y)/h];if(d.connections.includes(p)){const m=h-50;d.movimento[0]+=g[0]*m*.2,d.movimento[1]+=g[1]*m*.2,p.movimento[0]-=g[0]*m*.2,p.movimento[1]-=g[1]*m*.2}else d.movimento[0]-=g[0]*2e5/h**2,d.movimento[1]-=g[1]*2e5/h**2}const y=Math.sqrt(d.x**2+d.y**2),v=[(q[0]-d.x)/y,(q[1]-d.y)/y];d.movimento[0]+=v[0]*30,d.movimento[1]+=v[1]*30}}document.querySelectorAll(".node").forEach(r=>{r.x+=r.movimento[0]*.01,r.y+=r.movimento[1]*.01,i.isMouseDown&&(r.initialTranslate.x+=r.movimento[0]*.01,r.initialTranslate.y+=r.movimento[1]*.01);const d=$(r);r.style.transform=`translate(${d.x+r.movimento[0]*.01}px, ${d.y+r.movimento[1]*.01}px)`});const u=i.end_coords[0]-i.start_coords[0],c=i.end_coords[1]-i.start_coords[1];z(u,c)}}let ee=0,te=0;function C(e=0,o=0){const n=b.getContext("2d");n.clearRect(0,0,b.width,b.height);function s(t,a){const c="rgba(0,0,0,0.3)";n.beginPath(),n.moveTo(t-3,a),n.lineTo(t+3,a),n.moveTo(t,a-3),n.lineTo(t,a+3),n.strokeStyle=c,n.lineWidth=1,n.stroke()}if(!i.link_mode_on){let a=e+ee,u=o+te;for(;a>20/2;)a-=20;for(;a<-20/2;)a+=20;for(;u>20/2;)u-=20;for(;u<-20/2;)u+=20;for(let c=a;c<=b.width+a;c+=20)for(let r=u;r<=b.height+u;r+=20)s(c,r)}}function be(){const e=i.end_coords[0]-i.start_coords[0],o=i.end_coords[1]-i.start_coords[1];ee+=e,te+=o,q[0]+=e,q[1]+=o,C(0,0),i.dragged=!1,document.querySelectorAll(".node").forEach(n=>{n.x+=e,n.y+=o,n.style.left=n.x+"px",n.style.top=n.y+"px",n.style.transform="translate(-50%, -50%)"})}function $(e){const o=window.getComputedStyle(e),n=new WebKitCSSMatrix(o.transform);return{x:n.m41,y:n.m42}}function j(){document.querySelectorAll(".node").forEach(e=>e.remove()),document.querySelectorAll(".arrow").forEach(e=>e.remove()),i.nodes.length=0}function ne(e){return!i.nodes.find(n=>n.name===e)}function S(e){document.getElementById("Canvas_Text").innerText=e}function f(e,o=w,n=null,s=[]){const t=document.createElement(e);return n&&(t.id=n),s.forEach(a=>t.classList.add(a)),o.appendChild(t),t}const L=document.getElementById("circleCanvas");L.width=window.innerWidth;L.height=window.innerHeight;const Ee=document.getElementById("canvas-container");C();let N=!1;function we(){if(N=!N,!N){document.querySelectorAll(".menu-dropdown").forEach(h=>{h.addEventListener("animationend",g=>{h.remove()}),h.classList.remove("animate"),h.classList.add("reverse")});return}const e=f("div",Ee,null,["menu-dropdown","animate"]),o=f("button",e,"addbutton",["add-node"]),n=f("button",e,"savebutton",["base"]),s=f("div",n,null,["icon"]);s.style.maskImage="url(save.svg)";const t=f("button",e,"loadbutton",["base"]),a=f("div",t,null,["icon"]);a.style.maskImage="url(load.svg)";const u=f("button",e,"deletebutton",["base"]),c=f("div",u,null,["icon"]);c.style.maskImage="url(trash.svg)";const r=f("button",e,"infobutton",["base"]),d=f("div",r,null,["icon"]);d.style.maskImage="url(question-mark.svg)",d.style.maskSize="90%";const l=5,y=40,v=5,p=l*y+(l-1)*v+2*v;e.style.height=`${p}px`,ye(o,u,n,t,r)}window.addEventListener("resize",()=>{L.width=window.innerWidth,L.height=window.innerHeight,C()});let ke;document.addEventListener("click",e=>{i.isMouseDown=!1,clearInterval(ke),i.link_mode_on&&!e.target.closest(".node")&&!e.target.closest(".box")&&!i.dragged&&(_e(),C()),document.querySelector(".input-box")&&!(e.target.matches(".add-node, .add-node *")||e.target.matches(".input-box"))&&document.querySelector(".input-box").remove(),document.querySelector(".save-files-menu")&&!(e.target.matches(".save-files-menu, .save-files-menu *")||e.target.matches("#loadbutton, #loadbutton *")||e.target.matches("#savebutton, #savebutton *"))&&document.querySelector(".save-files-menu").remove(),e.target.closest("#box")||(document.querySelectorAll("#box").forEach(n=>n.remove()),i.box_opened=!1,!i.simulating&&!i.link_mode_on&&A()),i.dragged&&(be(),i.start_coords=[0,0],i.end_coords=[0,0]),document.getElementById("Canvas_Text").innerText!="Welcome"&&!i.link_mode_on&&S(i.current_save_file)});L.addEventListener("mousedown",function(e){i.isMouseDown=!0,i.start_coords=[e.clientX,e.clientY],i.end_coords=[e.clientX,e.clientY],i.nodes.forEach(o=>{o.initialTranslate=$(o)}),document.querySelectorAll(".arrow").forEach(o=>{o.initialTranslate=$(o)})});L.addEventListener("mousemove",function(e){const o=L.getBoundingClientRect();if(i.isMouseDown&&!i.box_opened){i.end_coords=[e.clientX-o.left,e.clientY-o.top];const n=i.end_coords[0]-i.start_coords[0],s=i.end_coords[1]-i.start_coords[1];i.nodes.forEach(t=>{const a=t.initialTranslate;t.style.transform=`translate(${a.x+n}px, ${a.y+s}px)`}),z(n,s),C(n,s),i.dragged=!0;return}});window.menu=we;
